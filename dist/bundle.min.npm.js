var nano_spa=function(){"use strict";var t=function(n,e,r,o){for(var p=1;p<e.length;p++){var i=e[p++],s="number"==typeof i?r[i]:i;1===e[p]?o[0]=s:2===e[p]?(o[1]=o[1]||{})[e[++p]]=s:3===e[p]?o[1]=Object.assign(o[1]||{},s):o.push(e[p]?n.apply(null,t(n,s,r,["",null])):s)}return o},n=function(t){for(var n,e,r=1,o="",p="",i=[0],s=function(t){1===r&&(t||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?i.push(t||o,0):3===r&&(t||o)?(i.push(t||o,1),r=2):2===r&&"..."===o&&t?i.push(t,3):2===r&&o&&!t?i.push(!0,2,o):4===r&&e&&(i.push(t||o,2,e),e=""),o=""},u=0;u<t.length;u++){u&&(1===r&&s(),s(u));for(var c=0;c<t[u].length;c++)n=t[u][c],1===r?"<"===n?(s(),i=[i],r=3):o+=n:p?n===p?p="":o+=n:'"'===n||"'"===n?p=n:">"===n?(s(),r=1):r&&("="===n?(r=4,e=o,o=""):"/"===n?(s(),3===r&&(i=i[0]),r=i,(i=i[0]).push(r,4),r=0):" "===n||"\t"===n||"\n"===n||"\r"===n?(s(),r=2):o+=n)}return s(),i},e="function"==typeof Map,r=e?new Map:{},o=e?function(t){var e=r.get(t);return e||r.set(t,e=n(t)),e}:function(t){for(var e="",o=0;o<t.length;o++)e+=t[o].length+"-"+t[o];return r[e]||(r[e]=n(t))};var p=function(n){var e=t(this,o(n),arguments,[]);return e.length>1?e:e[0]}.bind(function t(n,e,...r){const o={type:n,props:e,children:r};return o.props=o.props||{},o.props.style&&(o.props.style=(t=>t.trim().split("\n").map(t=>t.trim()).join(""))(o.props.style)),"function"==typeof n?function(n){if("AsyncFunction"===n.type.constructor.name)return t("__PROMISE__",{promise:n},[]);const e=n.type(n.props),r="function"==typeof e?e():e;return t(r.type,r.props,...r.children.concat(n.children))}(o):o});function i(t){let{type:n,props:e,children:r}=t;const o=function(t,n){t.forEach(t=>{void 0!==t&&null!==t&&("string"==typeof t||"number"==typeof t?n.appendChild(document.createTextNode(t)):Array.isArray(t)?t.map(({type:t,props:e,children:r})=>{n.appendChild(i.call(this,{type:t,props:e,children:r}))}):n.appendChild(i.call(this,{...t})))})}.bind(this);if("Link"===n)return this.LINK(t);if("__PROMISE__"===n)return this.PROMISE(t);const p=document.createElement(n);return function(t,n){Object.entries(t).forEach(([t,e])=>{if(t.startsWith("on")&&t.toLowerCase()===t)n[t]=e;else{if("use_state"===t)return;n.setAttribute(t,e)}})}(e,p),o(r,p),p}const s=t=>({replace_with(n){t.innerHTML="",t.appendChild(n)},root:t}),u=(t={})=>{let n=[];const e=document.head,r=t["*"];if(r){const t=r();Array.isArray(t)?t.map(t=>e.appendChild(i(t))):e.appendChild(i(t))}return{set(r){if(!t[r])return n.map(t=>e.removeChild(t)),void(n=[]);n.map(t=>e.removeChild(t));const o=t[r]?t[r]():void 0;if(o)if(Array.isArray(o)){const t=o.map(t=>i(t));n=t,t.map(t=>e.appendChild(t))}else{const t=i(o);n=[t],e.appendChild(t)}}}},c=(t,n,e,r)=>{const o=t["*"]?t["*"]:()=>p`<h1 style='text-align: center;'>404</h1>`,s={PROMISE:t=>{const{props:n}=t,{placeholder:e,...r}=n.promise.props,o=n.promise.type(r),p=i(e());return o.then(t=>{p.parentNode.replaceChild(i(t),p)}),p},LINK:p=>{const s=i(p.children[0]),u=p.props.href,c=u.split("/").filter(t=>t),a=Object.keys(t).reduce((t,n)=>{const e=n.split("*").map(t=>t.replace(/\//g,""));return e.length===c.length?(t.src="/"+e.map(t=>t||"*").join("/"),t.params=c.filter(t=>-1===e.indexOf(t)),t):t},{});return s.href=u,s.onclick=(p=>{p.preventDefault(),r.on_route_unmount&&r.on_route_unmount(window.location.pathname,n.root.children[0]),window.history.pushState({},"",u),e.set(u);const s=i(t[u]?t[u]():t[a.src]?t[a.src](a.params):o());r.on_route_mount&&r.on_route_mount(u,s),n.replace_with(s)}),s}};return{get:n=>t[n]?i.call(s,t[n]()):i(o())}},a=(t,n,e,r)=>o=>{const p=e.get(o);n.set(o),t.replace_with(p),r.on_route_mount&&r.on_route_mount(o,p)},l=()=>window.location.pathname,h=(t,n,e)=>{document.querySelectorAll(".LINK").forEach(r=>{r.onclick=function(r){r.preventDefault();const o=this.getAttribute("href");l()!==o&&(e.on_route_unmount&&e.on_route_unmount(l(),n.root.children[0]),window.history.pushState({},"",o),t(o))}})};return Object.freeze({render:p,router:function(t){const{root:n,routes:e,head:r,methods:o}=t,p=s(n),i=u(r),d=c(e,p,i,o),f=a(p,i,d,o);h(f,p,o),f(l()),window.onpopstate=(()=>{o.on_route_unmount&&o.on_route_unmount(window.location.pathname,p.root.children[0]),f(l())})}})}();module.exports=nano_spa
