var nano_spa=function(){"use strict";var t=function(e,n,r,o){for(var i=1;i<n.length;i++){var s=n[i++],p="number"==typeof s?r[s]:s;1===n[i]?o[0]=p:2===n[i]?(o[1]=o[1]||{})[n[++i]]=p:3===n[i]?o[1]=Object.assign(o[1]||{},p):o.push(n[i]?e.apply(null,t(e,p,r,["",null])):p)}return o},e=function(t){for(var e,n,r=1,o="",i="",s=[0],p=function(t){1===r&&(t||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?s.push(t||o,0):3===r&&(t||o)?(s.push(t||o,1),r=2):2===r&&"..."===o&&t?s.push(t,3):2===r&&o&&!t?s.push(!0,2,o):4===r&&n&&(s.push(t||o,2,n),n=""),o=""},c=0;c<t.length;c++){c&&(1===r&&p(),p(c));for(var u=0;u<t[c].length;u++)e=t[c][u],1===r?"<"===e?(p(),s=[s],r=3):o+=e:i?e===i?i="":o+=e:'"'===e||"'"===e?i=e:">"===e?(p(),r=1):r&&("="===e?(r=4,n=o,o=""):"/"===e?(p(),3===r&&(s=s[0]),r=s,(s=s[0]).push(r,4),r=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(p(),r=2):o+=e)}return p(),s},n="function"==typeof Map,r=n?new Map:{},o=n?function(t){var n=r.get(t);return n||r.set(t,n=e(t)),n}:function(t){for(var n="",o=0;o<t.length;o++)n+=t[o].length+"-"+t[o];return r[n]||(r[n]=e(t))};var i=function(e){var n=t(this,o(e),arguments,[]);return n.length>1?n:n[0]}.bind(function t(e,n,...r){const o={type:e,props:n,children:r};return o.props=o.props||{},o.props.style&&(o.props.style=(t=>t.trim().split("\n").map(t=>t.trim()).join(""))(o.props.style)),"function"==typeof e?function(e){if("AsyncFunction"===e.type.constructor.name)return t("__PROMISE__",{promise:e},[]);const n=e.type(e.props),r="function"==typeof n?n():n;return t(r.type,r.props,...r.children.concat(e.children))}(o):o});function s(t){let{type:e,props:n,children:r}=t;const o=function(t,e){t.forEach(t=>{void 0!=t&&("string"==typeof t||"number"==typeof t?e.appendChild(document.createTextNode(t)):Array.isArray(t)?t.map(t=>e.appendChild(s.call(this,{...t}))):e.appendChild(s.call(this,{...t})))})}.bind(this);if("Link"===e)return this.LINK(t);if("__PROMISE__"===e)return this.PROMISE(t);const i=document.createElement(e);return function(t,e){Object.entries(t).forEach(([t,n])=>{t.startsWith("on")&&t.toLowerCase()===t?e[t]=n:e.setAttribute(t,n)})}(n,i),o.call(this,r,i),i}const p=()=>window.location.pathname,c=t=>window.history.pushState({},"",t),u=(t,e,n)=>t.on_route_unmount&&t.on_route_unmount(n||p(),e.root.children[0]),a=t=>({replace_with(e){t.innerHTML="",t.appendChild(e)},root:t}),l=(t={})=>{const e=document.head;let n=[];const r=t=>{const n=s(t);return e.appendChild(n),n},o=t=>t.map(r),i=(t,e)=>t?Array.isArray(t)?e?n=o(t):o(t):e?n=[r(t)]:r(t):void 0;return i(t["*"]&&t["*"](),!1),{set(r){if((()=>n.map(t=>e.removeChild(t)))(),!t[r])return n=[];i(t[r](),!0)}}},h=(t,e,n,r)=>{const o=t["*"]?t["*"]:()=>i`<h1 style='text-align: center;'>404</h1>`,a=(t,o)=>{((t,e)=>t.on_route_mount&&t.on_route_mount(p(),e))(r,o),n.set(t),e.replace_with(o)},l=(e,n)=>{let r=void 0;return Object.keys(t).filter(t=>"*"!==t).map(o=>{if(t[e])return;const i=new RegExp(o),s=i.exec(e);if(i.test(e)&&s.length>=2){const[,...e]=s;r=n(t[o](e))}}),r},h={PROMISE:t=>{const e=s.bind(h),{props:n}=t,{placeholder:r,...o}=n.promise.props,i=n.promise.type(o),p=r(),c=e(p);return i.then(t=>{c.parentNode.replaceChild(e(t),c)}),c},LINK:n=>{const i=s.bind(h),p=n.children[0],d=i(p),f=n.props.href;d.href=f;const m=l(f,i);return d.onclick=(n=>{n.preventDefault(),u(r,e),c(f);const s=t[f]?i(t[f]()):m||i(o());a(f,s)}),d}};return{render:()=>{const e=s.bind(h),n=p(),r=l(n,e),i=t[n]?e(t[n]()):r||e(o());a(n,i)}}},d=(t,e,n)=>{document.querySelectorAll(".LINK").forEach(r=>{r.onclick=function(r){r.preventDefault();const o=this.getAttribute("href");p()!==o&&(u(n,e),c(o),t(o))}})};return Object.freeze({render:i,router:function(t){const{root:e,routes:n={},head:r={},methods:o={}}=t,i=a(e),s=l(r),c=h(n,i,s,o);d(c.render,i,o),c.render();let f=p();window.onpopstate=(()=>{u(o,i,f),f=p(),c.render()})}})}();module.exports=nano_spa
