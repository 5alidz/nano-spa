var nano_spa=function(){"use strict";var t=function(e,n,r,o){for(var s=1;s<n.length;s++){var i=n[s++],c="number"==typeof i?r[i]:i;1===n[s]?o[0]=c:2===n[s]?(o[1]=o[1]||{})[n[++s]]=c:3===n[s]?o[1]=Object.assign(o[1]||{},c):o.push(n[s]?e.apply(null,t(e,c,r,["",null])):c)}return o},e=function(t){for(var e,n,r=1,o="",s="",i=[0],c=function(t){1===r&&(t||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?i.push(t||o,0):3===r&&(t||o)?(i.push(t||o,1),r=2):2===r&&"..."===o&&t?i.push(t,3):2===r&&o&&!t?i.push(!0,2,o):4===r&&n&&(i.push(t||o,2,n),n=""),o=""},p=0;p<t.length;p++){p&&(1===r&&c(),c(p));for(var u=0;u<t[p].length;u++)e=t[p][u],1===r?"<"===e?(c(),i=[i],r=3):o+=e:s?e===s?s="":o+=e:'"'===e||"'"===e?s=e:">"===e?(c(),r=1):r&&("="===e?(r=4,n=o,o=""):"/"===e?(c(),3===r&&(i=i[0]),r=i,(i=i[0]).push(r,4),r=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(c(),r=2):o+=e)}return c(),i},n="function"==typeof Map,r=n?new Map:{},o=n?function(t){var n=r.get(t);return n||r.set(t,n=e(t)),n}:function(t){for(var n="",o=0;o<t.length;o++)n+=t[o].length+"-"+t[o];return r[n]||(r[n]=e(t))};var s=function(e){var n=t(this,o(e),arguments,[]);return n.length>1?n:n[0]}.bind(function t(e,n,...r){const o={type:e,props:n,children:r};return o.props=o.props||{},o.props.style&&(o.props.style=(t=>t.trim().split("\n").map(t=>t.trim()).join(""))(o.props.style)),"function"==typeof e?function(e){if("AsyncFunction"===e.type.constructor.name)return t("__PROMISE__",{promise:e},[]);const n=e.type(e.props),r="function"==typeof n?n():n;return t(r.type,r.props,...r.children.concat(e.children))}(o):o}),i={root:void 0,routes:{},head:{},methods:{},cache:[]};function c(t){let{type:e,props:n,children:r}=t;const o=function(t,e){t.forEach(t=>{void 0!=t&&("string"==typeof t||"number"==typeof t?e.appendChild(document.createTextNode(t)):Array.isArray(t)?t.map(t=>e.appendChild(c.call(this,{...t}))):e.appendChild(c.call(this,{...t})))})}.bind(this);if("Link"===e)return this.LINK(t);if("__PROMISE__"===e)return this.PROMISE(t);const s=document.createElement(e);return function(t,e){Object.entries(t).forEach(([t,n])=>{t.startsWith("on")&&window.hasOwnProperty(t)?e[t]=n:e.setAttribute(t,n)})}(n,s),o(r,s),s}const p=()=>window.location.pathname,u=t=>window.history.pushState({},"",t),h=t=>i.methods.on_route_unmount&&i.methods.on_route_unmount(t||p(),i.root.children[0]),a=(t,e)=>{let n=void 0;return e[t]?n:(Object.keys(e).filter(n=>"*"!==n||e.hasOwnProperty(t)).map(r=>{const o=new RegExp(r);if(!o.test(t))return;const s=o.exec(t);if(o.test(t)&&s.length>=2){const[,...t]=s;n=e[r]?[e[r],t]:void 0}}),n)},d=document.head;let l=[];const f=t=>t.map(t=>{const e=c(t);return d.appendChild(e),e}),m=t=>Array.isArray(t)?t:[t],y=(t,e)=>e?l=f(m(t)):f(m(t)),v=()=>y(i.head["*"]&&i.head["*"](),!1),_=t=>{(()=>l.map(t=>d.removeChild(t)))();const e=a(t,i.head);return e?y(e[0](e[1]),!0):i.head[t]?void y(i.head[t](),!0):l=[]},g=(t,e)=>i.routes[t]?i.routes[t]():e?e[0](e[1]):(()=>i.routes["*"]?i.routes["*"]:()=>s`<h1 style='text-align: center;'>404</h1>`)()(),b=(t,e)=>{(t=>i.methods.on_route_mount&&i.methods.on_route_mount(p(),t))(e),_(t),w=e,i.root.innerHTML="",i.root.appendChild(w)};var w;const O={},E={PROMISE(t){const e=c.bind(this),{props:n}=t,{placeholder:r,...o}=n.promise.props,s=n.promise.type(o),i=r(),p=e(i);return s.then(t=>{p.replaceWith(e(t))}),p},LINK(t){const e=c.bind(this),n=t.children[0],r=e(n),o=t.props.href;"href"in r&&(r.href=o);const s=a(o,i.routes);return r.onclick=(t=>{if(t.preventDefault(),p()==o)return;h(),u(o);const n=e(g(o,s));b(o,n)}),r}},A=()=>{const t=c.bind(E),e=p(),n=i.cache.includes(e),r=a(e,i.routes),o=t(g(e,r));O[e]||(O[e]=o),b(e,n?o:O[e])},I=t=>{document.querySelectorAll(".LINK").forEach(e=>{e.onclick=function(e){e.preventDefault();const n=this.getAttribute("href");p()!==n&&(h(),u(n),t())}})};return{render:s,router:function(t){Object.assign(i,t),I(A),v(),A();let e=p();window.onpopstate=(()=>{h(e),e=p(),A()})},to_dom:c.bind(E)}}();module.exports=nano_spa
