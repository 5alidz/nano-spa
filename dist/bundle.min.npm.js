var nano_spa=function(){"use strict";var t=function(n,e,r,o){for(var i=1;i<e.length;i++){var p=e[i++],s="number"==typeof p?r[p]:p;1===e[i]?o[0]=s:2===e[i]?(o[1]=o[1]||{})[e[++i]]=s:3===e[i]?o[1]=Object.assign(o[1]||{},s):o.push(e[i]?n.apply(null,t(n,s,r,["",null])):s)}return o},n=function(t){for(var n,e,r=1,o="",i="",p=[0],s=function(t){1===r&&(t||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?p.push(t||o,0):3===r&&(t||o)?(p.push(t||o,1),r=2):2===r&&"..."===o&&t?p.push(t,3):2===r&&o&&!t?p.push(!0,2,o):4===r&&e&&(p.push(t||o,2,e),e=""),o=""},c=0;c<t.length;c++){c&&(1===r&&s(),s(c));for(var u=0;u<t[c].length;u++)n=t[c][u],1===r?"<"===n?(s(),p=[p],r=3):o+=n:i?n===i?i="":o+=n:'"'===n||"'"===n?i=n:">"===n?(s(),r=1):r&&("="===n?(r=4,e=o,o=""):"/"===n?(s(),3===r&&(p=p[0]),r=p,(p=p[0]).push(r,4),r=0):" "===n||"\t"===n||"\n"===n||"\r"===n?(s(),r=2):o+=n)}return s(),p},e="function"==typeof Map,r=e?new Map:{},o=e?function(t){var e=r.get(t);return e||r.set(t,e=n(t)),e}:function(t){for(var e="",o=0;o<t.length;o++)e+=t[o].length+"-"+t[o];return r[e]||(r[e]=n(t))};var i=function(n){var e=t(this,o(n),arguments,[]);return e.length>1?e:e[0]}.bind(function t(n,e,...r){const o={type:n,props:e,children:r};return o.props=o.props||{},o.props.style&&(o.props.style=(t=>t.trim().split("\n").map(t=>t.trim()).join(""))(o.props.style)),"function"==typeof n?function(n){if("AsyncFunction"===n.type.constructor.name)return t("__PROMISE__",{promise:n},[]);const e=n.type(n.props),r="function"==typeof e?e():e;return t(r.type,r.props,...r.children.concat(n.children))}(o):o});function p(t){let{type:n,props:e,children:r}=t;const o=function(t,n){t.forEach(t=>{void 0!=t&&("string"==typeof t||"number"==typeof t?n.appendChild(document.createTextNode(t)):Array.isArray(t)?t.map(t=>n.appendChild(p.call(this,{...t}))):n.appendChild(p.call(this,{...t})))})}.bind(this);if("Link"===n)return this.LINK(t);if("__PROMISE__"===n)return this.PROMISE(t);const i=document.createElement(n);return function(t,n){Object.entries(t).forEach(([t,e])=>{t.startsWith("on")&&t.toLowerCase()===t?n[t]=e:n.setAttribute(t,e)})}(e,i),o.call(this,r,i),i}const s=()=>window.location.pathname,c=t=>window.history.pushState({},"",t),u=(t,n)=>t.on_route_unmount&&t.on_route_unmount(s(),n.root.children[0]),a=t=>({replace_with(n){t.innerHTML="",t.appendChild(n)},root:t}),h=(t={})=>{const n=document.head;let e=[];const r=t=>{const e=p(t);return n.appendChild(e),e},o=t=>t.map(r),i=(t,n)=>t?Array.isArray(t)?n?e=o(t):o(t):n?e=[r(t)]:r(t):void 0;return i(t["*"]&&t["*"](),!1),{set(r){if((()=>e.map(t=>n.removeChild(t)))(),!t[r])return e=[];i(t[r](),!0)}}},l=(t,n,e,r)=>{const o=t["*"]?t["*"]:()=>i`<h1 style='text-align: center;'>404</h1>`,a=(t,o)=>{((t,n)=>t.on_route_mount&&t.on_route_mount(s(),n))(r,o),e.set(t),n.replace_with(o)},h={PROMISE:t=>{const n=p.bind(h),{props:e}=t,{placeholder:r,...o}=e.promise.props,i=e.promise.type(o),s=r(),c=n(s);return i.then(t=>{c.parentNode.replaceChild(n(t),c)}),c},LINK:e=>{const i=p.bind(h),s=e.children[0],l=i(s),d=e.props.href;return l.href=d,l.onclick=(e=>{e.preventDefault(),u(r,n),c(d);const p=t[d]?i(t[d]()):i(o());a(d,p)}),l}};return{render:()=>{const n=p.bind(h),e=s(),r=t[e]?n(t[e]()):n(o());a(e,r)}}},d=(t,n,e)=>{document.querySelectorAll(".LINK").forEach(r=>{r.onclick=function(r){r.preventDefault();const o=this.getAttribute("href");s()!==o&&(u(e,n),c(o),t(o))}})};return Object.freeze({render:i,router:function(t){const{root:n,routes:e={},head:r={},methods:o={}}=t,i=a(n),p=h(r),s=l(e,i,p,o);d(s.render,i,o),s.render(),window.onpopstate=(()=>{u(o,i),s.render()})}})}();module.exports=nano_spa
