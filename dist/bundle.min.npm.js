var nano_spa=function(){"use strict";var e=function(t,n,r,o){for(var p=1;p<n.length;p++){var s=n[p++],i="number"==typeof s?r[s]:s;1===n[p]?o[0]=i:2===n[p]?(o[1]=o[1]||{})[n[++p]]=i:3===n[p]?o[1]=Object.assign(o[1]||{},i):o.push(n[p]?t.apply(null,e(t,i,r,["",null])):i)}return o},t=function(e){for(var t,n,r=1,o="",p="",s=[0],i=function(e){1===r&&(e||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?s.push(e||o,0):3===r&&(e||o)?(s.push(e||o,1),r=2):2===r&&"..."===o&&e?s.push(e,3):2===r&&o&&!e?s.push(!0,2,o):4===r&&n&&(s.push(e||o,2,n),n=""),o=""},c=0;c<e.length;c++){c&&(1===r&&i(),i(c));for(var a=0;a<e[c].length;a++)t=e[c][a],1===r?"<"===t?(i(),s=[s],r=3):o+=t:p?t===p?p="":o+=t:'"'===t||"'"===t?p=t:">"===t?(i(),r=1):r&&("="===t?(r=4,n=o,o=""):"/"===t?(i(),3===r&&(s=s[0]),r=s,(s=s[0]).push(r,4),r=0):" "===t||"\t"===t||"\n"===t||"\r"===t?(i(),r=2):o+=t)}return i(),s},n="function"==typeof Map,r=n?new Map:{},o=n?function(e){var n=r.get(e);return n||r.set(e,n=t(e)),n}:function(e){for(var n="",o=0;o<e.length;o++)n+=e[o].length+"-"+e[o];return r[n]||(r[n]=t(e))};var p=function(t){var n=e(this,o(t),arguments,[]);return n.length>1?n:n[0]}.bind(function e(t,n,...r){const o={type:t,props:n,children:r};return o.props=o.props||{},o.props.style&&(o.props.style=(e=>e.trim().split("\n").map(e=>e.trim()).join(""))(o.props.style)),"function"==typeof t?function(t){if("AsyncFunction"===t.type.constructor.name)return e("__PROMISE__",{promise:t},[]);const n=t.type(t.props),r="function"==typeof n?n():n;return e(r.type,r.props,...r.children.concat(t.children))}(o):o});function s(e){let{type:t,props:n,children:r}=e;const o=function(e,t){e.forEach(e=>{void 0!==e&&null!==e&&("string"==typeof e||"number"==typeof e?t.appendChild(document.createTextNode(e)):Array.isArray(e)?e.map(({type:e,props:n,children:r})=>{t.appendChild(s.call(this,{type:e,props:n,children:r}))}):t.appendChild(s.call(this,{...e})))})}.bind(this);if("Link"===t)return this.LINK(e);if("__PROMISE__"===t)return this.PROMISE(e);const p=document.createElement(t);return function(e,t){Object.entries(e).forEach(([e,n])=>{if(e.startsWith("on")&&e.toLowerCase()===e)t[e]=n;else{if("use_state"===e)return;t.setAttribute(e,n)}})}(n,p),o(r,p),p}const i=()=>window.location.pathname,c=(e,t)=>e.on_route_unmount&&e.on_route_unmount(i(),t.root.children[0]),a=(e,t)=>e.on_route_mount&&e.on_route_mount(i(),t),u=e=>({replace_with(t){e.innerHTML="",e.appendChild(t)},root:e}),l=(e={})=>{let t=[];const n=()=>t.map(e=>r.removeChild(e)),r=document.head,o=e["*"];if(o){const e=o();Array.isArray(e)?e.map(e=>r.appendChild(s(e))):r.appendChild(s(e))}return{set(o){if(!e[o])return n(),void(t=[]);n();const p=e[o]();if(Array.isArray(p)){(t=p.map(e=>s(e))).map(e=>r.appendChild(e))}else{const e=t=[s(p)];r.appendChild(e[0])}}}},h=(e,t,n,r)=>{const o=e["*"]?e["*"]:()=>p`<h1 style='text-align: center;'>404</h1>`,i={PROMISE:e=>{const{props:t}=e,{placeholder:n,...r}=t.promise.props,o=t.promise.type(r),p=s(n());return o.then(e=>{p.parentNode.replaceChild(s(e),p)}),p},LINK:p=>{const i=s(p.children[0]),u=p.props.href,l=u.split("/").filter(e=>e),h=Object.keys(e).reduce((e,t)=>{const n=t.split("*").map(e=>e.replace(/\//g,""));return n.length===l.length?(e.src="/"+n.map(e=>e||"*").join("/"),e.params=l.filter(e=>-1===n.indexOf(e)),e):e},{});return i.href=u,i.onclick=(p=>{p.preventDefault(),c(r,t),window.history.pushState({},"",u),n.set(u);const i=s(e[u]?e[u]():e[h.src]?e[h.src](h.params):o());a(r,i),t.replace_with(i)}),i}};return{render:()=>{const p=window.location.pathname,c=e[p]?s.call(i,e[p]()):s(o());n.set(p),t.replace_with(c),a(r,c)}}},d=(e,t,n)=>{document.querySelectorAll(".LINK").forEach(r=>{r.onclick=function(r){r.preventDefault();const o=this.getAttribute("href");i()!==o&&(c(n,t),window.history.pushState({},"",o),e(o))}})};return Object.freeze({render:p,router:function(e){const{root:t,routes:n={},head:r={},methods:o={}}=e,p=u(t),s=l(r),i=h(n,p,s,o);d(i.render,p,o),i.render(),window.onpopstate=(()=>{c(o,p),i.render()})}})}();module.exports=nano_spa
