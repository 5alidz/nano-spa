var nano_spa=function(){"use strict";var t=function(e,n,r,o){for(var i=1;i<n.length;i++){var s=n[i++],c="number"==typeof s?r[s]:s;1===n[i]?o[0]=c:2===n[i]?(o[1]=o[1]||{})[n[++i]]=c:3===n[i]?o[1]=Object.assign(o[1]||{},c):o.push(n[i]?e.apply(null,t(e,c,r,["",null])):c)}return o},e=function(t){for(var e,n,r=1,o="",i="",s=[0],c=function(t){1===r&&(t||(o=o.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?s.push(t||o,0):3===r&&(t||o)?(s.push(t||o,1),r=2):2===r&&"..."===o&&t?s.push(t,3):2===r&&o&&!t?s.push(!0,2,o):4===r&&n&&(s.push(t||o,2,n),n=""),o=""},p=0;p<t.length;p++){p&&(1===r&&c(),c(p));for(var u=0;u<t[p].length;u++)e=t[p][u],1===r?"<"===e?(c(),s=[s],r=3):o+=e:i?e===i?i="":o+=e:'"'===e||"'"===e?i=e:">"===e?(c(),r=1):r&&("="===e?(r=4,n=o,o=""):"/"===e?(c(),3===r&&(s=s[0]),r=s,(s=s[0]).push(r,4),r=0):" "===e||"\t"===e||"\n"===e||"\r"===e?(c(),r=2):o+=e)}return c(),s},n="function"==typeof Map,r=n?new Map:{},o=n?function(t){var n=r.get(t);return n||r.set(t,n=e(t)),n}:function(t){for(var n="",o=0;o<t.length;o++)n+=t[o].length+"-"+t[o];return r[n]||(r[n]=e(t))};var i=function(e){var n=t(this,o(e),arguments,[]);return n.length>1?n:n[0]}.bind(function t(e,n,...r){const o={type:e,props:n,children:r};return o.props=o.props||{},o.props.style&&(o.props.style=(t=>t.trim().split("\n").map(t=>t.trim()).join(""))(o.props.style)),"function"==typeof e?function(e){if("AsyncFunction"===e.type.constructor.name)return t("__PROMISE__",{promise:e},[]);const n=e.type(e.props),r="function"==typeof n?n():n;return t(r.type,r.props,...r.children.concat(e.children))}(o):o});function s(t){let{type:e,props:n,children:r}=t;const o=function(t,e){t.forEach(t=>{void 0!=t&&("string"==typeof t||"number"==typeof t?e.appendChild(document.createTextNode(t)):Array.isArray(t)?t.map(t=>e.appendChild(s.call(this,{...t}))):e.appendChild(s.call(this,{...t})))})}.bind(this);if("Link"===e)return this.LINK(t);if("__PROMISE__"===e)return this.PROMISE(t);const i=document.createElement(e);return function(t,e){Object.entries(t).forEach(([t,n])=>{t.startsWith("on")&&t.toLowerCase()===t?e[t]=n:e.setAttribute(t,n)})}(n,i),o.call(this,r,i),i}const c=()=>window.location.pathname,p=t=>window.history.pushState({},"",t),u=(t,e,n)=>t.on_route_unmount&&t.on_route_unmount(n||c(),e.root.children[0]),a=(t,e)=>{let n=void 0;return Object.keys(e).filter(t=>"*"!==t).map(r=>{if(e[t])return;const o=new RegExp(r),i=o.exec(t);if(o.test(t)&&i.length>=2){const[,...t]=i;n=e[r]?[e[r],t]:void 0}}),n},l=t=>({replace_with(e){t.innerHTML="",t.appendChild(e)},root:t}),h=(t={})=>{const e=document.head;let n=[];const r=t=>{const n=s(t);return e.appendChild(n),n},o=t=>t.map(r),i=(t,e)=>t?Array.isArray(t)?e?n=o(t):o(t):e?n=[r(t)]:r(t):void 0;return i(t["*"]&&t["*"](),!1),{set(r){(()=>n.map(t=>e.removeChild(t)))();const o=a(r,t);return o?i(o[0](o[1]),!0):t[r]?void i(t[r](),!0):n=[]}}},d=(t,e,n,r,o)=>{const l={},h=t["*"]?t["*"]:()=>i`<h1 style='text-align: center;'>404</h1>`,d=(e,n)=>t[e]?t[e]():n?n[0](n[1]):h(),f=(t,o)=>{((t,e)=>t.on_route_mount&&t.on_route_mount(c(),e))(r,o),n.set(t),e.replace_with(o)},m={PROMISE:t=>{const e=s.bind(m),{props:n}=t,{placeholder:r,...o}=n.promise.props,i=n.promise.type(o),c=r(),p=e(c);return i.then(t=>{p.parentNode.replaceChild(e(t),p)}),p},LINK:n=>{const o=s.bind(m),i=n.children[0],c=o(i),l=n.props.href;c.href=l;const h=a(l,t);return c.onclick=(t=>{t.preventDefault(),u(r,e),p(l);const n=o(d(l,h));f(l,n)}),c}};return{render:()=>{const e=s.bind(m),n=c(),r=o.includes(n),i=a(n,t),p=e(d(n,i));l[n]||(l[n]=p),f(n,r?p:l[n])}}},f=(t,e,n)=>{document.querySelectorAll(".LINK").forEach(r=>{r.onclick=function(r){r.preventDefault();const o=this.getAttribute("href");c()!==o&&(u(n,e),p(o),t(o))}})};return Object.freeze({render:i,router:function(t){const{root:e,routes:n={},head:r={},methods:o={},cache:i=[]}=t,s=l(e),p=h(r),a=d(n,s,p,o,i);f(a.render,s,o),a.render();let m=c();window.onpopstate=(()=>{u(o,s,m),m=c(),a.render()})}})}();module.exports=nano_spa
